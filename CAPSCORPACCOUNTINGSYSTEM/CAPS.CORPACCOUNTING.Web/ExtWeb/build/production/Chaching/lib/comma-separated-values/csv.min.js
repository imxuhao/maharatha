!function(){function G(a){var c=typeof a;return"function"===c||"object"===c&&!!a}function q(a){return"string"==typeof a}function B(a){return !isNaN(Number(a))}function x(a){return 0==a||1==a}function b(a){return null==a}function k(a){return null!=a}function D(a,c){return k(a)?a:c}function F(c,f){for(var d=0,a=c.length;a>d&&f(c[d],d)!==!1;d+=1){}}function H(a){return"attrs["+a+"]"}function E(a,c){return B(a)?"Number("+H(c)+")":x(a)?"Boolean("+H(c)+" == true)":"String("+H(c)+")"}function w(c,f,d){var a=[];return 2==arguments.length?(c?v(c)?F(f,function(h,g){a.push(c[g]+"("+H(g)+")")}):F(f,function(e,g){a.push(E(e,g))}):F(f,function(e,g){a.push(H(g))}),a="return ["+a.join(",")+"]"):(c?v(c)?F(f,function(g,e){a.push('"'+d[e]+'": '+c[e]+"("+H(e)+")")}):F(f,function(e,g){a.push('"'+d[g]+'": '+E(e,g))}):F(f,function(e,g){a.push('"'+d[g]+'": '+H(g))}),a="return {"+a.join(",")+"}"),new Function("attrs",a)}function A(c,f){var d,a=0;return F(f,function(h){var e,g=h;-1!=y.indexOf(h)&&(g="\\"+g),e=c.match(new RegExp(g,"g")),e&&e.length>a&&(a=e.length,d=h)}),d||f[0]}var y=["|","^"],j=[",",";"," ","|","^"],C=["\r\n","\r","\n"],v=Array.isArray||function(a){return"[object Array]"===toString.call(a)},z=function(){function d(h,m){if(m||(m={}),v(h)){this.mode="encode"}else{if(!q(h)){throw new Error("Incompatible format!")}this.mode="parse"}this.data=h,this.options={header:D(m.header,!1),cast:D(m.cast,!0)};var g=m.lineDelimiter||m.line,l=m.cellDelimiter||m.delimiter;this.isParser()?(this.options.lineDelimiter=g||A(this.data,C),this.options.cellDelimiter=l||A(this.data,j),this.data=f(this.data,this.options.lineDelimiter)):this.isEncoder()&&(this.options.lineDelimiter=g||"\r\n",this.options.cellDelimiter=l||",")}function a(g,i,h){g(new i(h))}function f(e,g){return e.slice(-g.length)!=g&&(e+=g),e}function c(g){return v(g)?"array":G(g)?"object":q(g)?"string":b(g)?"null":"primitive"}return d.prototype.set=function(e,g){return this.options[e]=g},d.prototype.isParser=function(){return"parse"==this.mode},d.prototype.isEncoder=function(){return"encode"==this.mode},d.prototype.parse=function(J){function Q(){L={escaped:!1,quote:!1,cell:!0}}function V(){T.cell=""}function M(){T.line=[]}function P(e){T.line.push(L.escaped?e.slice(1,-1).replace(/""/g,'"'):e),V(),Q()}function X(e){P(e.slice(0,1-O.lineDelimiter.length))}function I(){W?v(W)?(Y=w(O.cast,T.line,W),(I=function(){a(J,Y,T.line)})()):W=T.line:(Y||(Y=w(O.cast,T.line)),(I=function(){a(J,Y,T.line)})())}if("parse"==this.mode){if(0===this.data.trim().length){return[]}var L,Y,U,S=this.data,O=this.options,W=O.header,T={cell:"",line:[]};J||(U=[],J=function(e){U.push(e)}),1==O.lineDelimiter.length&&(X=P);var i,m,N,l=S.length,K=O.cellDelimiter.charCodeAt(0),R=O.lineDelimiter.charCodeAt(O.lineDelimiter.length-1);for(Q(),i=0,m=0;l>i;i++){N=S.charCodeAt(i),L.cell&&(L.cell=!1,34==N)?L.escaped=!0:L.escaped&&34==N?L.quote=!L.quote:(L.escaped&&L.quote||!L.escaped)&&(N==K?(P(T.cell+S.slice(m,i)),m=i+1):N==R&&(X(T.cell+S.slice(m,i)),m=i+1,I(),M()))}return U?U:this}},d.prototype.serialize={object:function(h){var m=this,l=Object.keys(h),g=Array(l.length);return F(l,function(n,i){g[i]=m[c(h[n])](h[n])}),g},array:function(g){var i=this,h=Array(g.length);return F(g,function(l,e){h[e]=i[c(l)](l)}),h},string:function(e){return'"'+String(e).replace(/"/g,'""')+'"'},"null":function(){return""},primitive:function(e){return e}},d.prototype.encode=function(P){function u(e){return e.join(s.cellDelimiter)}if("encode"==this.mode){if(0==this.data.length){return""}var M,J,g=this.data,s=this.options,N=s.header,O=g[0],I=this.serialize,L=0;P||(J=Array(g.length),P=function(e,h){J[h+L]=e}),N&&(v(N)||(M=Object.keys(O),N=M),P(u(I.array(N)),0),L=1);var K,m=c(O);return"array"==m?(v(s.cast)?(K=Array(s.cast.length),F(s.cast,function(e,h){K[h]=e.toLowerCase()})):(K=Array(O.length),F(O,function(e,h){K[h]=c(e)})),F(g,function(n,h){var l=Array(K.length);F(n,function(e,i){l[i]=I[K[i]](e)}),P(u(l),h)})):"object"==m&&(M=Object.keys(O),v(s.cast)?(K=Array(s.cast.length),F(s.cast,function(e,h){K[h]=e.toLowerCase()})):(K=Array(M.length),F(M,function(e,h){K[h]=c(O[e])})),F(g,function(e,h){var l=Array(M.length);F(M,function(i,o){l[o]=I[K[o]](e[i])}),P(u(l),h)})),J?J.join(s.lineDelimiter):this}},d.prototype.forEach=function(e){return this[this.mode](e)},d}();z.parse=function(a,c){return new z(a,c).parse()},z.encode=function(a,c){return new z(a,c).encode()},z.forEach=function(a,d,c){return 2==arguments.length&&(c=d),new z(a,d).forEach(c)},"function"==typeof define&&define.amd?define("CSV",[],function(){return z}):"object"==typeof module&&module.exports?module.exports=z:window&&(window.CSV=z)}();